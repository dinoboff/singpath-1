#!/usr/bin/env bash

NODE_ENV=production

echo "Backing up config..."
cp src/config.js src/config.clean.js

echo "Finding all dependencies..."
jspm depcache app.js

echo "Building app bundle..."
jspm bundle-sfx app.js build/app.js --minify

echo "Copying Ace editor assets..."
cp src/jspm_packages/github/ajaxorg/ace-builds@*/worker-html.js build/worker-html.js
cp src/jspm_packages/github/ajaxorg/ace-builds@*/worker-javascript.js build/worker-javascript.js
cp src/jspm_packages/github/ajaxorg/ace-builds@*/worker-html.js build/worker-html.js

echo "Restoring config..."
mv src/config.clean.js src/config.js
